// 20 Ð¾Ð±Ð»Ð°ÑÑ‚Ð½Ñ‹Ñ… Ñ†ÐµÐ½Ñ‚Ñ€Ð¾Ð² + 3 Ð³Ð¾Ñ€Ð¾Ð´Ð° Ñ€ÐµÑÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ð½ÑÐºÐ¾Ð³Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
const REGIONAL_CENTERS = {
  // Ð“Ð¾Ñ€Ð¾Ð´Ð° Ñ€ÐµÑÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ð½ÑÐºÐ¾Ð³Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
  'ÐÑÑ‚Ð°Ð½Ð°': 'ÐÑÑ‚Ð°Ð½Ð°',
  'Astana': 'ÐÑÑ‚Ð°Ð½Ð°',
  'Nur-Sultan': 'ÐÑÑ‚Ð°Ð½Ð°',
  'ÐÑƒÑ€-Ð¡ÑƒÐ»Ñ‚Ð°Ð½': 'ÐÑÑ‚Ð°Ð½Ð°',
  
  'ÐÐ»Ð¼Ð°Ñ‚Ñ‹': 'ÐÐ»Ð¼Ð°Ñ‚Ñ‹',
  'Almaty': 'ÐÐ»Ð¼Ð°Ñ‚Ñ‹',
  
  'Ð¨Ñ‹Ð¼ÐºÐµÐ½Ñ‚': 'Ð¨Ñ‹Ð¼ÐºÐµÐ½Ñ‚',
  'Shymkent': 'Ð¨Ñ‹Ð¼ÐºÐµÐ½Ñ‚',
  
  // ÐžÐ±Ð»Ð°ÑÑ‚Ð½Ñ‹Ðµ Ñ†ÐµÐ½Ñ‚Ñ€Ñ‹ (20)
  'Ð¡ÐµÐ¼ÐµÐ¹': 'Ð¡ÐµÐ¼ÐµÐ¹',
  'Semey': 'Ð¡ÐµÐ¼ÐµÐ¹',
  'Semei': 'Ð¡ÐµÐ¼ÐµÐ¹',
  
  'ÐšÓ©ÐºÑˆÐµÑ‚Ð°Ñƒ': 'ÐšÓ©ÐºÑˆÐµÑ‚Ð°Ñƒ',
  'ÐšÐ¾ÐºÑˆÐµÑ‚Ð°Ñƒ': 'ÐšÓ©ÐºÑˆÐµÑ‚Ð°Ñƒ',
  'Kokshetau': 'ÐšÓ©ÐºÑˆÐµÑ‚Ð°Ñƒ',
  
  'ÐÒ›Ñ‚Ó©Ð±Ðµ': 'ÐÒ›Ñ‚Ó©Ð±Ðµ',
  'ÐÐºÑ‚Ð¾Ð±Ðµ': 'ÐÒ›Ñ‚Ó©Ð±Ðµ',
  'Aktobe': 'ÐÒ›Ñ‚Ó©Ð±Ðµ',
  
  'ÒšÐ¾Ð½Ð°ÐµÐ²': 'ÒšÐ¾Ð½Ð°ÐµÐ²',
  'ÐšÐ¾Ð½Ð°ÐµÐ²': 'ÒšÐ¾Ð½Ð°ÐµÐ²',
  'Konaev': 'ÒšÐ¾Ð½Ð°ÐµÐ²',
  'Kapchagay': 'ÒšÐ¾Ð½Ð°ÐµÐ²',
  'ÐšÐ°Ð¿ÑˆÐ°Ð³Ð°Ð¹': 'ÒšÐ¾Ð½Ð°ÐµÐ²',
  
  'ÐÑ‚Ñ‹Ñ€Ð°Ñƒ': 'ÐÑ‚Ñ‹Ñ€Ð°Ñƒ',
  'Atyrau': 'ÐÑ‚Ñ‹Ñ€Ð°Ñƒ',
  
  'Ó¨ÑÐºÐµÐ¼ÐµÐ½': 'Ó¨ÑÐºÐµÐ¼ÐµÐ½',
  'Ð£ÑÑ‚ÑŒ-ÐšÐ°Ð¼ÐµÐ½Ð¾Ð³Ð¾Ñ€ÑÐº': 'Ó¨ÑÐºÐµÐ¼ÐµÐ½',
  'Oskemen': 'Ó¨ÑÐºÐµÐ¼ÐµÐ½',
  'Ust-Kamenogorsk': 'Ó¨ÑÐºÐµÐ¼ÐµÐ½',
  
  'Ð¢Ð°Ñ€Ð°Ð·': 'Ð¢Ð°Ñ€Ð°Ð·',
  'Taraz': 'Ð¢Ð°Ñ€Ð°Ð·',
  
  'Ð¢Ð°Ð»Ð´Ñ‹Ò›Ð¾Ñ€Ò“Ð°Ð½': 'Ð¢Ð°Ð»Ð´Ñ‹Ò›Ð¾Ñ€Ò“Ð°Ð½',
  'Ð¢Ð°Ð»Ð´Ñ‹ÐºÐ¾Ñ€Ð³Ð°Ð½': 'Ð¢Ð°Ð»Ð´Ñ‹Ò›Ð¾Ñ€Ò“Ð°Ð½',
  'Taldykorgan': 'Ð¢Ð°Ð»Ð´Ñ‹Ò›Ð¾Ñ€Ò“Ð°Ð½',
  
  'ÐžÑ€Ð°Ð»': 'ÐžÑ€Ð°Ð»',
  'Ð£Ñ€Ð°Ð»ÑŒÑÐº': 'ÐžÑ€Ð°Ð»',
  'Oral': 'ÐžÑ€Ð°Ð»',
  'Uralsk': 'ÐžÑ€Ð°Ð»',
  
  'ÒšÐ°Ñ€Ð°Ò“Ð°Ð½Ð´Ñ‹': 'ÒšÐ°Ñ€Ð°Ò“Ð°Ð½Ð´Ñ‹',
  'ÐšÐ°Ñ€Ð°Ð³Ð°Ð½Ð´Ð°': 'ÒšÐ°Ñ€Ð°Ò“Ð°Ð½Ð´Ñ‹',
  'Karaganda': 'ÒšÐ°Ñ€Ð°Ò“Ð°Ð½Ð´Ñ‹',
  
  'ÒšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹': 'ÒšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹',
  'ÐšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹': 'ÒšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹',
  'Kostanay': 'ÒšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹',
  
  'ÒšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð°': 'ÒšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð°',
  'ÐšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð°': 'ÒšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð°',
  'Kyzylorda': 'ÒšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð°',
  
  'ÐÒ›Ñ‚Ð°Ñƒ': 'ÐÒ›Ñ‚Ð°Ñƒ',
  'ÐÐºÑ‚Ð°Ñƒ': 'ÐÒ›Ñ‚Ð°Ñƒ',
  'Aktau': 'ÐÒ›Ñ‚Ð°Ñƒ',
  
  'ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€': 'ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€',
  'Pavlodar': 'ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€',
  
  'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»': 'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»',
  'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»Ð¾Ð²ÑÐº': 'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»',
  'Petropavl': 'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»',
  'Petropavlovsk': 'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»',
  
  'Ð¢Ò¯Ñ€ÐºÑ–ÑÑ‚Ð°Ð½': 'Ð¢Ò¯Ñ€ÐºÑ–ÑÑ‚Ð°Ð½',
  'Ð¢ÑƒÑ€ÐºÐµÑÑ‚Ð°Ð½': 'Ð¢Ò¯Ñ€ÐºÑ–ÑÑ‚Ð°Ð½',
  'Turkistan': 'Ð¢Ò¯Ñ€ÐºÑ–ÑÑ‚Ð°Ð½',
  
  'Ð–ÐµÐ·Ò›Ð°Ð·Ò“Ð°Ð½': 'Ð–ÐµÐ·Ò›Ð°Ð·Ò“Ð°Ð½',
  'Ð–ÐµÐ·ÐºÐ°Ð·Ð³Ð°Ð½': 'Ð–ÐµÐ·Ò›Ð°Ð·Ò“Ð°Ð½',
  'Zhezkazgan': 'Ð–ÐµÐ·Ò›Ð°Ð·Ò“Ð°Ð½',
};

// Mapping Ð¾Ð±Ð»Ð°ÑÑ‚ÐµÐ¹ Ð¿Ð¾ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ð¼ (ÑƒÑ‚Ð¾Ñ‡Ð½ÐµÐ½Ð½Ñ‹Ðµ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹)
const REGION_BY_COORDINATES = [
  // ÐÑÑ‚Ð°Ð½Ð°
  { lat: [50.9, 51.3], lon: [71.2, 71.7], center: 'ÐÑÑ‚Ð°Ð½Ð°' },
  
  // ÐÐ»Ð¼Ð°Ñ‚Ñ‹
  { lat: [43.1, 43.4], lon: [76.7, 77.1], center: 'ÐÐ»Ð¼Ð°Ñ‚Ñ‹' },
  
  // Ð¨Ñ‹Ð¼ÐºÐµÐ½Ñ‚
  { lat: [42.2, 42.4], lon: [69.4, 69.8], center: 'Ð¨Ñ‹Ð¼ÐºÐµÐ½Ñ‚' },
  
  // ÐÐ±Ð°Ð¹ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (Ð¡ÐµÐ¼ÐµÐ¹)
  { lat: [49.5, 51.0], lon: [79.0, 82.0], center: 'Ð¡ÐµÐ¼ÐµÐ¹' },
  
  // ÐÐºÐ¼Ð¾Ð»Ð¸Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (ÐšÓ©ÐºÑˆÐµÑ‚Ð°Ñƒ)
  { lat: [52.5, 53.5], lon: [68.5, 70.5], center: 'ÐšÓ©ÐºÑˆÐµÑ‚Ð°Ñƒ' },
  
  // ÐÐºÑ‚ÑŽÐ±Ð¸Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
  { lat: [48.5, 51.5], lon: [55.0, 61.0], center: 'ÐÒ›Ñ‚Ó©Ð±Ðµ' },
  
  // ÐÐ»Ð¼Ð°Ñ‚Ð¸Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (ÒšÐ¾Ð½Ð°ÐµÐ²)
  { lat: [43.0, 44.5], lon: [77.0, 79.5], center: 'ÒšÐ¾Ð½Ð°ÐµÐ²' },
  
  // ÐÑ‚Ñ‹Ñ€Ð°ÑƒÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
  { lat: [46.0, 48.0], lon: [49.5, 53.0], center: 'ÐÑ‚Ñ‹Ñ€Ð°Ñƒ' },
  
  // Ð’Ð¾ÑÑ‚Ð¾Ñ‡Ð½Ð¾-ÐšÐ°Ð·Ð°Ñ…ÑÑ‚Ð°Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (Ó¨ÑÐºÐµÐ¼ÐµÐ½)
  { lat: [48.5, 50.5], lon: [80.5, 85.0], center: 'Ó¨ÑÐºÐµÐ¼ÐµÐ½' },
  
  // Ð–Ð°Ð¼Ð±Ñ‹Ð»ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (Ð¢Ð°Ñ€Ð°Ð·)
  { lat: [42.5, 44.0], lon: [70.5, 73.0], center: 'Ð¢Ð°Ñ€Ð°Ð·' },
  
  // Ð–ÐµÑ‚Ñ‹ÑÑƒÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (Ð¢Ð°Ð»Ð´Ñ‹Ò›Ð¾Ñ€Ò“Ð°Ð½)
  { lat: [44.5, 46.5], lon: [78.0, 81.0], center: 'Ð¢Ð°Ð»Ð´Ñ‹Ò›Ð¾Ñ€Ò“Ð°Ð½' },
  
  // Ð—Ð°Ð¿Ð°Ð´Ð½Ð¾-ÐšÐ°Ð·Ð°Ñ…ÑÑ‚Ð°Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (ÐžÑ€Ð°Ð»)
  { lat: [49.5, 51.5], lon: [50.0, 54.5], center: 'ÐžÑ€Ð°Ð»' },
  
  // ÐšÐ°Ñ€Ð°Ð³Ð°Ð½Ð´Ð¸Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
  { lat: [47.5, 50.5], lon: [71.0, 76.0], center: 'ÒšÐ°Ñ€Ð°Ò“Ð°Ð½Ð´Ñ‹' },
  
  // ÐšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
  { lat: [51.5, 54.0], lon: [61.0, 68.0], center: 'ÒšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹' },
  
  // ÐšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð¸Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
  { lat: [43.5, 46.5], lon: [60.5, 66.5], center: 'ÒšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð°' },
  
  // ÐœÐ°Ð½Ð³Ð¸ÑÑ‚Ð°ÑƒÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (ÐÒ›Ñ‚Ð°Ñƒ)
  { lat: [43.0, 45.5], lon: [50.0, 55.0], center: 'ÐÒ›Ñ‚Ð°Ñƒ' },
  
  // ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
  { lat: [51.5, 53.5], lon: [75.0, 79.5], center: 'ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€' },
  
  // Ð¡ÐµÐ²ÐµÑ€Ð¾-ÐšÐ°Ð·Ð°Ñ…ÑÑ‚Ð°Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»)
  { lat: [53.5, 55.0], lon: [68.0, 70.0], center: 'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»' },
  
  // Ð¢ÑƒÑ€ÐºÐµÑÑ‚Ð°Ð½ÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ
  { lat: [41.5, 43.0], lon: [67.0, 69.5], center: 'Ð¢Ò¯Ñ€ÐºÑ–ÑÑ‚Ð°Ð½' },
  
  // Ð£Ð»Ñ‹Ñ‚Ð°ÑƒÑÐºÐ°Ñ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ (Ð–ÐµÐ·Ò›Ð°Ð·Ò“Ð°Ð½)
  { lat: [46.5, 48.5], lon: [66.5, 70.5], center: 'Ð–ÐµÐ·Ò›Ð°Ð·Ò“Ð°Ð½' },
];

/**
 * ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð³Ð¾Ñ€Ð¾Ð´Ð¾Ð² Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð° (Ð½Ð° ÐºÐ°Ð·Ð°Ñ…ÑÐºÐ¾Ð¼)
 */
function getKazakhstanCities() {
  return [
    'ÐÑÑ‚Ð°Ð½Ð°',
    'ÐÐ»Ð¼Ð°Ñ‚Ñ‹',
    'Ð¨Ñ‹Ð¼ÐºÐµÐ½Ñ‚',
    'ÐÒ›Ñ‚Ð°Ñƒ',
    'ÐÒ›Ñ‚Ó©Ð±Ðµ',
    'ÐÑ‚Ñ‹Ñ€Ð°Ñƒ',
    'Ð–ÐµÐ·Ò›Ð°Ð·Ò“Ð°Ð½',
    'ÐšÓ©ÐºÑˆÐµÑ‚Ð°Ñƒ',
    'ÒšÐ°Ñ€Ð°Ò“Ð°Ð½Ð´Ñ‹',
    'ÒšÐ¾Ð½Ð°ÐµÐ²',
    'ÒšÐ¾ÑÑ‚Ð°Ð½Ð°Ð¹',
    'ÒšÑ‹Ð·Ñ‹Ð»Ð¾Ñ€Ð´Ð°',
    'ÐžÑ€Ð°Ð»',
    'ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€',
    'ÐŸÐµÑ‚Ñ€Ð¾Ð¿Ð°Ð²Ð»',
    'Ð¡ÐµÐ¼ÐµÐ¹',
    'Ð¢Ð°Ð»Ð´Ñ‹Ò›Ð¾Ñ€Ò“Ð°Ð½',
    'Ð¢Ð°Ñ€Ð°Ð·',
    'Ð¢Ò¯Ñ€ÐºÑ–ÑÑ‚Ð°Ð½',
    'Ó¨ÑÐºÐµÐ¼ÐµÐ½',
  ].sort();
}

/**
 * ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¾Ð±Ð»Ð°ÑÑ‚Ð½Ð¾Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€ Ð¿Ð¾ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ð¼ Ñ‡ÐµÑ€ÐµÐ· Nominatim API
 */
async function getCityByCoordinates(lat, lon) {
  try {
    const response = await fetch(
      `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&accept-language=kk`,
      {
        headers: {
          'User-Agent': 'ImanTap/1.0' // Nominatim Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ User-Agent
        }
      }
    );
    
    if (!response.ok) {
      throw new Error('Geocoding failed');
    }
    
    const data = await response.json();
    
    // Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð³Ð¾Ñ€Ð¾Ð´ Ð¸Ð· Ð¾Ñ‚Ð²ÐµÑ‚Ð°
    const city = data.address?.city || 
                 data.address?.town || 
                 data.address?.village ||
                 data.address?.state;
    
    console.log('ðŸ“ Geocoding result:', {
      lat,
      lon,
      city,
      fullAddress: data.display_name
    });
    
    // Ð•ÑÐ»Ð¸ Ð³Ð¾Ñ€Ð¾Ð´ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½, Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¾Ð±Ð»Ð°ÑÑ‚Ð½Ð¾Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€
    if (city) {
      return getRegionalCenter(city, lat, lon);
    }
    
    // Ð•ÑÐ»Ð¸ Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹
    return getRegionalCenterByCoords(lat, lon);
    
  } catch (error) {
    console.error('âŒ Geocoding error:', error);
    // Fallback Ð½Ð° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ð¼
    return getRegionalCenterByCoords(lat, lon);
  }
}

/**
 * ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¾Ð±Ð»Ð°ÑÑ‚Ð½Ð¾Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ð¼ (Ð±ÐµÐ· API)
 */
function getRegionalCenterByCoords(lat, lon) {
  for (const region of REGION_BY_COORDINATES) {
    if (
      lat >= region.lat[0] && lat <= region.lat[1] &&
      lon >= region.lon[0] && lon <= region.lon[1]
    ) {
      return region.center;
    }
  }
  
  // Ð•ÑÐ»Ð¸ Ð½Ðµ Ð¿Ð¾Ð¿Ð°Ð» Ð½Ð¸ Ð² Ð¾Ð´Ð½Ñƒ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ð¹ Ð¾Ð±Ð»Ð°ÑÑ‚Ð½Ð¾Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€
  let minDistance = Infinity;
  let closestCenter = 'ÐÑÑ‚Ð°Ð½Ð°';
  
  for (const region of REGION_BY_COORDINATES) {
    const centerLat = (region.lat[0] + region.lat[1]) / 2;
    const centerLon = (region.lon[0] + region.lon[1]) / 2;
    const distance = Math.sqrt(
      Math.pow(lat - centerLat, 2) + Math.pow(lon - centerLon, 2)
    );
    
    if (distance < minDistance) {
      minDistance = distance;
      closestCenter = region.center;
    }
  }
  
  console.log(`ðŸ“ Fallback: closest center for [${lat}, ${lon}] is ${closestCenter}`);
  return closestCenter;
}

/**
 * ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¾Ð±Ð»Ð°ÑÑ‚Ð½Ð¾Ð¹ Ñ†ÐµÐ½Ñ‚Ñ€ Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ Ð³Ð¾Ñ€Ð¾Ð´Ð°
 */
function getRegionalCenter(cityName, lat, lon) {
  // 1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ñ€ÑÐ¼Ð¾Ðµ ÑÐ¾Ð²Ð¿Ð°Ð´ÐµÐ½Ð¸Ðµ
  if (REGIONAL_CENTERS[cityName]) {
    return REGIONAL_CENTERS[cityName];
  }
  
  // 2. Ð•ÑÐ»Ð¸ ÐµÑÑ‚ÑŒ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¸Ñ…
  if (lat && lon) {
    return getRegionalCenterByCoords(lat, lon);
  }
  
  // 3. Fallback
  return 'ÐÑÑ‚Ð°Ð½Ð°';
}

module.exports = {
  getCityByCoordinates,
  getRegionalCenter,
  getRegionalCenterByCoords,
  getKazakhstanCities,
  REGIONAL_CENTERS,
};